---
title: "Predicting readmission probability for diabetes inpatients"
author: "Modern Data Mining"
date: ' '
output:
  pdf_document:
    toc: yes
    toc_depth: '4'
  html_document:
    code_folding: show
    highlight: haddock
    theme: lumen
    toc: yes
    toc_depth: 4
    toc_float: yes
  word_document:
    toc: yes
    toc_depth: '4'
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 7, fig.height = 4)
if(!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2, glmnet, car, data.table)   #add your packages here
```




# Executive Summary

Diabetes is well known in the United States, being a medical conditions that affect millions of people for a majority of their lives. In some cases, there are times in which readmission to hospitals may occur, which are extremely costly. Under such a pretense, the Centers for Medicare and Medicaid Services announced in 2012 that they would no longer reimburse hospitals for services rendered if a patient was readmitted with complications within 30 days of discharge.

Therefore, it would be beneficial to understand what factors heavily influence such an event, and help provide a prognosis on who may be at risk of being readmitted.

Using the readmission data set produced by a group in STAT 571/701, we will attempt to produce a model that could provide such a diagnosis. With over 30 numeric and categorical variables being considered, our goal is to create an understandable and accessible model that can help hospitals and patients limit such a costly experience.

This data set contains over 100000 observations of around 70000 unique patients who could have been readmitted to the hospital multiple times, and contains detailed information on their medical history, admission and discharge details, patient demographics, and identifiers. Patients spend 1-14 days in the hospital, have a large range of up to 81 medications used, and may have had multiple procedures performed on them.


For our methodology, we first used various models, including Linear Modeling, and Linear Regression, in order to determine which one was the best one. By splitting it into training and test data with K-fold cross validation, we determined the validity and flexibility of our model as well.

Some issues that have come up during the project are similar to many others you may see - missing data which was ignored, but largely has been cleaned.


# Analysis Process

```{r data preparation, include=FALSE}
# Notice that we hide the code and the results here
# Using `include=F` in the chunk declaration. 
readmis <- read.csv("readmission.csv")
```
## Data Summary / EDA
Beginning with the data summary, as previously described, we continue with the readmission.csv data set. First, it would be beneficial to understand general information about each group.

One thing to note beforehand is the number of categorical variables that are found here. There are numerous anti-diabetic medications, race and gender variables, and diagnosis. Let's be sure to change them into factors.
```{r data preparation, include=FALSE}
cols <- c("race", "gender", "max_glu_serum", "A1Cresult", "metformin", "glimepiride", "glipizide", "glyburide", "pioglitazone", "rosiglitazone", "insulin", "change", "diabetesMed", "adm_src_mod", "adm_typ_mod", "age_mod", "diag1_mod", "diag2_mod", "diag3_mod", "readmitted", "disch_disp_modified")
readmis[cols] <- lapply(readmis[cols], factor)
```
Now, it becomes easier for us to determine overarching characteristics of each variable.
```{r EDA summary, include=FALSE}
summary(readmis)
names(readmis)
dim(readmis) #101766 patient
length(unique(readmis$patient_nbr))
```


First, we take notice that there over 101,766 observations with 31 variables. The number of unique observations of the variable $patient_nbr$ also indicates that there at 71,518 unique patients in this data set. It becomes clear here that there are numerous readmission of the same patients in this dataset, which affects the way in which we approach our modeling.

Furthermore, 
Based on our own intuition, there are some particular variables that would be obvious candidates as having a strong influence for readmission. Some interesting characteristics to first note down from the summary of the data is that 
(i) the range of a hospital stay was between 1-14 days
(ii) the number of medications ranged from 1 to 81
(iii) the number of and diagnosis ranged from 1 to 16

Note that each one of these variables showed variability in comparison to others. 

We would also like to note some minor information is missing from 
some variables like race and gender, upon which we ignored and kept in the dataset.

Based on the goal of our study, we also modified our $readmitted$ variable, so that the only two unique possible values are either "NO" or "<30", as ">30" would not result in a large cost for the hospital.

```{r modify prediction variable, include=FALSE}
readmis$readmitted[readmis$readmitted == ">30"] <- "NO"
readmis$readmitted <- factor(readmis$readmitted) # refactor for updated levels
unique(readmis$readmitted)
```

Simplicity is key within our models, so it would beneficial to continue to look at the other variables and determine which ones may be better to eliminate.

We will first remove $encounter_id$ and $patient_nbr$ for the sake of our analysis, as these are just identifiers that should not be included in the analysis.

```{r modify prediction variable, include=FALSE}
readmis_cln = subset(readmis, select=-c(encounter_id, patient_nbr))
readmis_cln$readmitted <- as.numeric(readmis_cln$readmitted)
```

## Analysis
To begin with capturing important factors, let us start off with a linear model to get quick results.

```{r linear model, include=FALSE}
fit.first.lm <- lm(readmitted ~., readmis_cln)
summary(fit.first.lm)
Anova(fit.first.lm)
```

It becomes clear here that there are numerous variables in which we must reduce from - the simpler the model, the better. We continue to try to narrow down which important factors will capture the chance of readmission.

## Conclusion

From the *Goals* section above, your study should respond to the following:

## Analyses suggested

1) Identify important factors that capture the chance of a readmission within 30 days. 

The set of available predictors is not limited to the raw variables in the data set. You may engineer any factors using the data, that you think will improve your model's quality.

2) For the purpose of classification, propose a model that can be used to predict whether a patient will be a readmit within 30 days. Justify your choice. Hint: use a decision criterion, such as AUC, to choose among a few candidate models.

3) Based on a quick and somewhat arbitrary guess, we estimate **it costs twice as much** to mislabel a readmission than it does to mislabel a non-readmission. Based on this risk ratio, propose a specific classification rule to minimize the cost. If you find any information that could provide a better cost estimate, please justify it in your write-up and use the better estimate in your answer.

Suggestion: You may use any of the methods covered so far in parts 1) and 2), and they need not be the same. Also keep in mind that a training/testing data split may be necessary. 

4) We suggest you to split the data first to Training/Testing/Validation data:

- Use training/testing data to land a final model (If you only use LASSO to land a final model, we will not need testing data since all the decisions are made with cross-validations.)

- Evaluate the final model with the validation data to give an honest assessment of your final model. 
